# 発見されたバグ一覧

## 修正済み

### 1. 型比較バグ（2025-12-29 修正済み）
- **ファイル**: `js/script.js:311`, `js/admin.js:972,999,1003`
- **問題**: `propertyCode`の比較で`parseInt()`を使用していたが、masterDataの値は文字列型
- **修正**: `String()`で統一

### 2. テンプレートキーのタイポ（2025-12-29 修正済み）
- **ファイル**: `js/script.js:30`, `images/automtic_doors.png`
- **問題**: `automatic_doors`（正）と `automtic_doors`（誤：aが抜けている）の不一致
- **影響**: 「自動扉点検」を選択してもテンプレート画像が表示されない
- **修正**:
  - `js/script.js`のキーを`automatic_doors`に修正
  - 画像ファイル名を`automtic_doors.png`から`automatic_doors.png`にリネーム

### 3. バリデーションエラー時のサイレントフェイル（2025-12-29 検証済み - 誤報）
- **ファイル**: `js/script.js:229-307` (addEntry関数)
- **検証結果**: バリデーションは正しく実装されており、エラートーストも表示される
- **備考**: 手動テスト時にトーストを見逃した可能性あり。Playwrightテストで正常動作を確認

### 4. 不正な日付範囲のバリデーション（2025-12-29 検証済み - 誤報）
- **ファイル**: `js/script.js:292-302`
- **検証結果**: 日付範囲のバリデーションは正しく実装されている
- **動作**:
  - 点検終了日 < 開始日の場合: 「点検終了日は開始日以降にしてください」エラー
  - 表示終了日 < 開始日の場合: 「表示終了日は開始日以降にしてください」エラー
- **備考**: Playwrightテストで正常動作を確認

### 5. 物件マスターデータ構造の不一致（2025-12-29 修正済み）
- **ファイル**: `js/supabase-client.js:112-143`
- **問題**: コードはフラットな`terminal_id`フィールドを期待していたが、Supabaseは`terminals`（JSON配列）を返す
- **影響**:
  - 端末セレクトボックスに`value="undefined"`、空テキストのオプションが表示される
  - 物件選択後、端末が正しく表示されない
- **修正内容**:
  - `getAllMasterData()`を修正し、`terminals`がJSON配列の場合（新形式）と`terminal_id`がフラットな場合（旧形式）の両方に対応
  - テスト用モックデータも新形式に更新

## 未修正

### 6. DBの日付関連カラムにNULL値
- **ファイル**: Supabase `signage_entries`テーブル
- **問題**: `display_start_time`, `display_end_date`, `display_end_time`, `inspection_end` などが全てNULL
- **影響**: 一部のレコードで必要な日付情報が保存されていない可能性
- **確認必要**: 意図的な設計かバグかの判断が必要

---
*最終更新: 2025-12-29 (バグ#5修正済み)*
